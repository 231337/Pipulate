<!doctype html>
<html>
  <head>
    <title>Pipulate</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Nunito:700' rel='stylesheet' type='text/css'>
    <link href="http://picnicss.com/releases/v2.3.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <style>
    #pipurl{margin-bottom:10px}
    #paste{
      font-weight:normal;
    }
    #pipstream{
      margin: 0px 20px 0px 20px;
    }
    .spinner {
      margin: 5px auto 0;
      width: 70px;
      text-align: center;
      position: fixed;
      left: 0;
      right: 0;
    }
    .spinner > div {
      width: 18px;
      height: 18px;
      background-color: #333;
      border-radius: 100%;
      display: inline-block;
      -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
      animation: bouncedelay 1.4s infinite ease-in-out;
      /* Prevent first frame from flickering when animation starts */
      -webkit-animation-fill-mode: both;
      animation-fill-mode: both;
    }
    .spinner .bounce1 {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
    }
    .spinner .bounce2 {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
    }
    @-webkit-keyframes bouncedelay {
      0%, 80%, 100% { -webkit-transform: scale(0.0) }
      40% { -webkit-transform: scale(1.0) }
    }
    @keyframes bouncedelay {
      0%, 80%, 100% { 
        transform: scale(0.0);
        -webkit-transform: scale(0.0);
      } 40% { 
        transform: scale(1.0);
        -webkit-transform: scale(1.0);
      }
    }
    body {
      display: block;
      font-size: 16px;
      color: #333;
      background: #FFF;
      margin-top: 60px;
      width: 100%;}
    nav{
      background-color:#EEEEEE;
    }
    #content{
      margin:5px 5px 5px 5px;
      text-align:center;
    }
    #arrow{
      font-weight: bold;
      font-size: 1.8em;
      color: #323232;
      position : relative;
      top:.2em;
    }
    #drag{
      font-size: 1em;
      position : relative;
      top:.1em;
    }
    .bookmarklet{padding: 0px;}
    .burgercheck~label{
      font-size:1.7em;}
    .pressthis{
      margin:4px 40px 8px 5px;
      float: left;
      }
    .pressthis a,.pressthis a:active,.pressthis a:focus,.pressthis a:hover{
      display:inline-block;
      position:relative;cursor:
      move;color:#333;
      background:#e6e6e6;
      -webkit-border-radius:5px;
      border-radius:5px;
      border:1px solid #b4b4b4;
      font-family:Nunito;
      font-style:normal;
      font-size:14px;
      text-decoration:none}
    .pressthis a:active{
      outline:0}
    .pressthis a:hover:after{
      -webkit-transform:skew(20deg) rotate(9deg);
      -ms-transform:skew(20deg) rotate(9deg);
      transform:skew(20deg) rotate(9deg);
      -webkit-box-shadow:0 10px 8px rgba(0,0,0,.7);
      box-shadow:0 10px 8px rgba(0,0,0,.7)}
    .pressthis a span{
      display:inline-block;
      margin:0px 15px 0px 15px;}
    .pressthis a span:
      before{color:#777;
      font:400 20px/1 ;
      position:relative;
      display:inline-block;
      top:4px;
      margin-right:4px}
    .pressthis a:after{
      content:'';
      width:70%;
      height:55%;
      z-index:-1;
      position:absolute;
      right:10px;
      bottom:9px;
      background:0 0;
      -webkit-transform:skew(20deg) rotate(6deg);
      -ms-transform:skew(20deg) rotate(6deg);
      transform:skew(20deg) rotate(6deg);
      -webkit-box-shadow:0 10px 8px rgba(0,0,0,.6);
      box-shadow:0 10px 8px rgba(0,0,0,.6)}
    </style>
    <script>
      $(document).ready(function(){  
        $("#spinner").hide();
      });
      if (location.hash) {
        var myhash = location.hash
        if (myhash.indexOf('access_token') > 0) {
          myhash = myhash.substring(1, myhash.length);
          window.location = "http://{{ request.headers['Host'] }}?" + myhash;
        }
      }
    </script>
  </head>
  <body>
    <div id="content">
      <form method="POST" action="/">
        <span id="paste">URL: </span>{{ form.pipurl(size=70) }}<br/>
          <button id="pipulate" class="button" type="submit" value="Start Pipulating" name="submit">
            Start Pipulating &nbsp;<i id="piplock" class="fa fa-chevron-circle-right"></i>
          </button>
      </form>
    </div>
    <nav>
    <!-- responsive -->
    <input id="bmenu" class="burgercheck" type="checkbox">
    <label for="bmenu" class="burgermenu"></label>
    <!-- /responsive -->
        <div class="pressthis" style="text-align: center"><a class="bookmarklet" href="{{ bookmarklet }}" onclick="return false;" oncontextmenu="if(window.navigator.userAgent.indexOf('WebKit')!=-1||window.navigator.userAgent.indexOf('MSIE')!=-1){jQuery('.pressthis-code').show().find('textarea').focus().select();return false;}"><span>Pipulate</span></a> <strong id="arrow">&larr;</strong> <span id="drag">Drag to Boomarks Bar.</span></div>
    <div class="menu">
      <a href="{{ loginlink }}">Login with Google</a>
      <a href="{{ logoutlink }}">Logout</a>
    </div>
    </nav>
    <div id="spinner" class="spinner">
      <div class="bounce1"></div>
      <div class="bounce2"></div>
      <div class="bounce3"></div>
    </div>
    <div id="pipflash">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class=flashes>
        {% for message in messages %}
          <br/>{{ message }}
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    </div>
    <div id="pipstream">
    {% for msg in data: -%}
      {% if msg == "spinon" %}
        <script>
          // Lock button and display spinner
          $('#pipulate').prop("disabled", true)
          $('#pipulate').fadeTo("fast",.5);
          $('#spinner').show()
        </script>
      {% elif msg == "spinoff" %}
        <script>
          // Unlock button and remove spinner
          $('#pipulate').prop("disabled", false)
          $('#pipulate').fadeTo("fast",1);
          $('#spinner').hide()
          $( "i" ).removeClass( "fa-spin fa-circle-o-notch" )
          $( "i" ).addClass( "fa-check" )
          $('#piplock').addClass("fa-chevron-circle-right")
          $('#piplock').removeClass("fa-lock")
        </script>
      {% elif msg == "spindown" %}
        <script>
          // Unlock button and gracefully show user things are fubar.
          $('#pipulate').prop("disabled", false)
          $('#pipulate').fadeTo("fast",1);
          $('#spinner').hide()
          $( "i" ).removeClass( "fa-spin fa-circle-o-notch" )
          $( "i" ).addClass( "fa-frown-o" )
          $('#piplock').addClass("fa-chevron-circle-right")
          $('#piplock').removeClass("fa-lock")
        </script>
      {% elif msg[:1] == ',' -%}
        {{ msg }}
      {%- else -%}
        <script>
          $( "i" ).removeClass( "fa-spin fa-circle-o-notch" )
          $( "i" ).addClass( "fa-check" )
          $('#piplock').removeClass("fa-chevron-circle-right")
          $('#piplock').addClass("fa-lock")
        </script>
        <br/><i class="fa fa-circle-o-notch fa-spin"></i></i> {{ msg }}
      {%- endif %}
    {%- endfor %}
    </div>
  </body>
</html>
